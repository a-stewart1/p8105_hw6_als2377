Homework 5
================
Allison Stewart

This is my solution for Homework 6.

## Problem 1

``` r
homicide_df = 
  read_csv("homicide-data.csv", na = c("", "NA", "Unknown")) %>% 
  mutate(
    city_state = str_c(city, state, sep = ", "),
    victim_age = as.numeric(victim_age),
    resolution = case_when(
      disposition == "Closed without arrest" ~ 0,
      disposition == "Open/No arrest"        ~ 0,
      disposition == "Closed by arrest"      ~ 1)
  ) %>% 
  filter(
    victim_race %in% c("White", "Black"),
    city_state != "Tulsa, AL") %>% 
  select(city_state, resolution, victim_age, victim_race, victim_sex)
```

    ## Parsed with column specification:
    ## cols(
    ##   uid = col_character(),
    ##   reported_date = col_double(),
    ##   victim_last = col_character(),
    ##   victim_first = col_character(),
    ##   victim_race = col_character(),
    ##   victim_age = col_double(),
    ##   victim_sex = col_character(),
    ##   city = col_character(),
    ##   state = col_character(),
    ##   lat = col_double(),
    ##   lon = col_double(),
    ##   disposition = col_character()
    ## )

Fit a logistic regression with resolved vs unresolved as the outcome and
victim age, sex and race as predictors.

``` r
baltimore_df =
  homicide_df %>% 
  filter(city_state == "Baltimore, MD")

glm(resolution ~ victim_age + victim_race + victim_sex, 
    data = baltimore_df,
    family = binomial()) %>% 
  broom::tidy() %>% 
  mutate(
    OR = exp(estimate),
    CI_lower = exp(estimate - 1.96 * std.error),
    CI_upper = exp(estimate + 1.96 * std.error)
  ) %>% 
  select(term, OR, starts_with("CI")) %>% 
  knitr::kable(digits = 3)
```

| term              |    OR | CI\_lower | CI\_upper |
| :---------------- | ----: | --------: | --------: |
| (Intercept)       | 1.363 |     0.975 |     1.907 |
| victim\_age       | 0.993 |     0.987 |     1.000 |
| victim\_raceWhite | 2.320 |     1.648 |     3.268 |
| victim\_sexMale   | 0.426 |     0.325 |     0.558 |

Run glm for each of the cities.

``` r
models_results_df = 
  homicide_df %>% 
  nest(data = -city_state) %>% 
  mutate(
    models = 
      map(.x = data, ~glm(resolution ~ victim_age + victim_race + victim_sex, data = .x, family = binomial())),
    results = map(models, broom::tidy)
  ) %>% 
  select(city_state, results) %>% 
  unnest(results) %>% 
  mutate(
    OR = exp(estimate),
    CI_lower = exp(estimate - 1.96 * std.error),
    CI_upper = exp(estimate + 1.96 * std.error)
  ) %>% 
  select(city_state, term, OR, starts_with("CI")) 
```

Create a plot that shows estimated ORs and CIs for each city.

``` r
models_results_df %>% 
  filter(term == "victim_sexMale") %>% 
  mutate(city_state = fct_reorder(city_state, OR)) %>% 
  ggplot(aes(x = city_state, y = OR)) + 
  geom_point() + 
  geom_errorbar(aes(ymin = CI_lower, ymax = CI_upper)) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

<img src="p8105_hw6_als2377_files/figure-gfm/unnamed-chunk-4-1.png" width="90%" />

# Problem 2

Import and clean data.

``` r
baby_df = 
  read_csv("birthweight.csv") %>%
  mutate(
    babysex = as.factor(babysex), 
    frace = as.factor(frace), 
    mrace = as.factor(mrace)) 
```

    ## Parsed with column specification:
    ## cols(
    ##   .default = col_double()
    ## )

    ## See spec(...) for full column specifications.

``` r
summarize(baby_df, count = sum(is.na(baby_df)))
```

    ## # A tibble: 1 x 1
    ##   count
    ##   <int>
    ## 1     0

Propose a regression model for birthweight.

``` r
model_fit = lm(bwt ~ gaweeks + delwt + fincome + smoken, data = baby_df) 

model_fit %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) %>% 
  mutate(term = str_replace(term, "\\(Intercept\\)","intercept")) %>% 
  knitr::kable(digits = 3)
```

| term      |  estimate | p.value |
| :-------- | --------: | ------: |
| intercept | \-161.294 |   0.076 |
| gaweeks   |    60.680 |   0.000 |
| delwt     |     5.599 |   0.000 |
| fincome   |     2.263 |   0.000 |
| smoken    |   \-7.599 |   0.000 |

Based on hypothesized variables that influenced babyweight, I included
the following variables in a linear regression model: motherâ€™s weight at
delivery (delwt), gestational age in weeks (gaweeks), family monthly
income (fincome), and average number cigarettes smoked per day during
pregnancy (smoken). The following plot shows the residuals of the model
plotted against the fitted values.

``` r
baby_df %>% 
  add_residuals(model_fit) %>% 
  add_predictions(model_fit) %>% 
  select(resid, pred, delwt, gaweeks, fincome, smoken) %>% 
  ggplot(aes(x = pred, y = resid)) + 
  geom_point() + 
  labs(
    title = "Residuals vs. Fitted Predictions", 
    x = "Fitted Prediction", 
    y = "Residuals"
  )
```

<img src="p8105_hw6_als2377_files/figure-gfm/unnamed-chunk-7-1.png" width="90%" />
